\hypertarget{poisson__2d_8cc_source}{\section{poisson\+\_\+2d.\+cc}
\label{poisson__2d_8cc_source}\index{examples/poisson\+\_\+2d/poisson\+\_\+2d.\+cc@{examples/poisson\+\_\+2d/poisson\+\_\+2d.\+cc}}
}

\begin{DoxyCode}
00001 
00039 \textcolor{comment}{/*}
00040 \textcolor{comment}{Copyright (C) 2015, Computational Science Research Center, San Diego State}
00041 \textcolor{comment}{University. All rights reserved.}
00042 \textcolor{comment}{}
00043 \textcolor{comment}{Redistribution and use in source and binary forms, with or without modification,}
00044 \textcolor{comment}{are permitted provided that the following conditions are met:}
00045 \textcolor{comment}{}
00046 \textcolor{comment}{1. Modifications to source code should be reported to: esanchez@mail.sdsu.edu}
00047 \textcolor{comment}{and a copy of the modified files should be reported once modifications are}
00048 \textcolor{comment}{completed, unless these modifications are made through the project's GitHub}
00049 \textcolor{comment}{page: http://www.csrc.sdsu.edu/mtk. Documentation related to said modifications}
00050 \textcolor{comment}{should be developed and included in any deliverable.}
00051 \textcolor{comment}{}
00052 \textcolor{comment}{2. Redistributions of source code must be done through direct}
00053 \textcolor{comment}{downloads from the project's GitHub page: http://www.csrc.sdsu.edu/mtk}
00054 \textcolor{comment}{}
00055 \textcolor{comment}{3. Redistributions in binary form must reproduce the above copyright notice,}
00056 \textcolor{comment}{this list of conditions and the following disclaimer in the documentation and/or}
00057 \textcolor{comment}{other materials provided with the distribution.}
00058 \textcolor{comment}{}
00059 \textcolor{comment}{4. Usage of the binary form on proprietary applications shall require explicit}
00060 \textcolor{comment}{prior written permission from the the copyright holders, and due credit should}
00061 \textcolor{comment}{be given to the copyright holders.}
00062 \textcolor{comment}{}
00063 \textcolor{comment}{5. Neither the name of the copyright holder nor the names of its contributors}
00064 \textcolor{comment}{may be used to endorse or promote products derived from this software without}
00065 \textcolor{comment}{specific prior written permission.}
00066 \textcolor{comment}{}
00067 \textcolor{comment}{The copyright holders provide no reassurances that the source code provided does}
00068 \textcolor{comment}{not infringe any patent, copyright, or any other intellectual property rights of}
00069 \textcolor{comment}{third parties. The copyright holders disclaim any liability to any recipient for}
00070 \textcolor{comment}{claims brought against recipient by any third party for infringement of that}
00071 \textcolor{comment}{parties intellectual property rights.}
00072 \textcolor{comment}{}
00073 \textcolor{comment}{THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND}
00074 \textcolor{comment}{ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED}
00075 \textcolor{comment}{WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00076 \textcolor{comment}{DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR}
00077 \textcolor{comment}{ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES}
00078 \textcolor{comment}{(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;}
00079 \textcolor{comment}{LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON}
00080 \textcolor{comment}{ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT}
00081 \textcolor{comment}{(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS}
00082 \textcolor{comment}{SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00083 \textcolor{comment}{*/}
00084 
00085 \textcolor{preprocessor}{#if \_\_cplusplus == 201103L}
00086 
00087 \textcolor{preprocessor}{#include <iostream>}
00088 \textcolor{preprocessor}{#include <fstream>}
00089 \textcolor{preprocessor}{#include <cmath>}
00090 
00091 \textcolor{preprocessor}{#include <vector>}
00092 
00093 \textcolor{preprocessor}{#include "\hyperlink{mtk_8h}{mtk.h}"}
00094 
00095 \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} Source(\textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &xx, \textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &yy) \{
00096 
00097   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} x\_squared\{xx*xx\};
00098   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} y\_squared\{yy*yy\};
00099   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} aux\{-0.5*(x\_squared + y\_squared)\};
00100 
00101   \textcolor{keywordflow}{return} xx*yy*exp(aux)*(x\_squared + y\_squared - 6.0);
00102 \}
00103 
00104 \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} BCCoeff(\textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &xx, \textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &yy) \{
00105 
00106   \textcolor{keywordflow}{return} \hyperlink{group__c01-roots_ga26407c24d43b6b95480943340d285c71}{mtk::kOne};
00107 \}
00108 
00109 \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} WestBC(\textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &xx, \textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &tt) \{
00110 
00111   \textcolor{keywordflow}{return} \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero};
00112 \}
00113 
00114 \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} EastBC(\textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &yy, \textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &tt) \{
00115 
00116   \textcolor{keywordflow}{return} yy*exp(-0.5*(\hyperlink{group__c01-roots_ga26407c24d43b6b95480943340d285c71}{mtk::kOne} + yy*yy));
00117 \}
00118 
00119 \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} SouthBC(\textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &xx, \textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &tt) \{
00120 
00121   \textcolor{keywordflow}{return} \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero};
00122 \}
00123 
00124 \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} NorthBC(\textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &xx, \textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &tt) \{
00125 
00126   \textcolor{keywordflow}{return} xx*exp(-0.5*(xx*xx + \hyperlink{group__c01-roots_ga26407c24d43b6b95480943340d285c71}{mtk::kOne}));
00127 \}
00128 
00129 \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} KnownSolution(\textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &xx, \textcolor{keyword}{const} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} &yy) \{
00130 
00131   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} x\_squared\{xx*xx\};
00132   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} y\_squared\{yy*yy\};
00133   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} aux\{-0.5*(x\_squared + y\_squared)\};
00134 
00135   \textcolor{keywordflow}{return} xx*yy*exp(aux);
00136 \}
00137 
00138 \textcolor{keywordtype}{int} \hyperlink{poisson__2d_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main} () \{
00139 
00140   std::cout << \textcolor{stringliteral}{"Example: Poisson Equation on a 2D Uniform Staggered Grid "};
00141   std::cout << \textcolor{stringliteral}{"with Dirichlet and Neumann BCs."} << std::endl;
00142 
00144   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} west\_bndy\_x\{0.0\};
00145   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} east\_bndy\_x\{1.0\};
00146   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} south\_bndy\_y\{0.0\};
00147   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} north\_bndy\_y\{1.0\};
00148   \textcolor{keywordtype}{int} num\_cells\_x\{5\};
00149   \textcolor{keywordtype}{int} num\_cells\_y\{5\};
00150 
00151   \hyperlink{classmtk_1_1UniStgGrid2D}{mtk::UniStgGrid2D} comp\_sol(west\_bndy\_x, east\_bndy\_x, num\_cells\_x,
00152                              south\_bndy\_y, north\_bndy\_y, num\_cells\_y);
00153 
00155   \hyperlink{classmtk_1_1Lap2D}{mtk::Lap2D} lap;
00156 
00157   \textcolor{keywordflow}{if} (!lap.\hyperlink{classmtk_1_1Lap2D_a188ee8fee643463affca7de2884711b1}{ConstructLap2D}(comp\_sol)) \{
00158     std::cerr << \textcolor{stringliteral}{"Mimetic Laplacian could not be built."} << std::endl;
00159     \textcolor{keywordflow}{return} EXIT\_FAILURE;
00160   \}
00161 
00162   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} lapm(lap.\hyperlink{classmtk_1_1Lap2D_aaac0a22eaa2f036869b24fd420ce5761}{ReturnAsDenseMatrix}());
00163 
00165   \hyperlink{classmtk_1_1UniStgGrid2D}{mtk::UniStgGrid2D} source(west\_bndy\_x, east\_bndy\_x, num\_cells\_x,
00166                            south\_bndy\_y, north\_bndy\_y, num\_cells\_y);
00167 
00168   source.BindScalarField(Source);
00169 
00171   \hyperlink{classmtk_1_1RobinBCDescriptor2D}{mtk::RobinBCDescriptor2D} bcd;
00172 
00173   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_a671a38d5ea78be8f0a88ccf034d09987}{PushBackWestCoeff}(BCCoeff);
00174   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_a7cc1e6ca729b8b092eb73161eb244160}{PushBackEastCoeff}(BCCoeff);
00175   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_ad74c5d9f2c1d0359d350348ac2a7e61e}{PushBackSouthCoeff}(BCCoeff);
00176   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_abc6e299516af5d1c5c2d04797875b446}{PushBackNorthCoeff}(BCCoeff);
00177 
00178   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_a0a26693f5265fcad978e7ba84e01ed69}{ImposeOnLaplacianMatrix}(lap, comp\_sol, lapm);
00179 
00180   \textcolor{keywordflow}{if} (!lapm.WriteToFile(\textcolor{stringliteral}{"poisson\_2d\_lapm.dat"})) \{
00181     std::cerr << \textcolor{stringliteral}{"Laplacian matrix could not be written to disk."} << std::endl;
00182     \textcolor{keywordflow}{return} EXIT\_FAILURE;
00183   \}
00184 
00186   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_aeaff87510dc1773effc0b5429579de23}{set\_west\_condition}(WestBC);
00187   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_a94570f6e741bb00038c4bf81842d226c}{set\_east\_condition}(EastBC);
00188   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_a3fbdf58ba24861011fd852f0c642a4c8}{set\_south\_condition}(SouthBC);
00189   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_ade17884e6a2636a7c6f989602a0052e0}{set\_north\_condition}(NorthBC);
00190 
00191   bcd.\hyperlink{classmtk_1_1RobinBCDescriptor2D_ac9564bc46c196cbf4720a0e4b93da8b0}{ImposeOnGrid}(source);
00192 
00193   \textcolor{keywordflow}{if}(!source.WriteToFile(\textcolor{stringliteral}{"poisson\_2d\_source.dat"}, \textcolor{stringliteral}{"x"}, \textcolor{stringliteral}{"y"}, \textcolor{stringliteral}{"s(x,y)"})) \{
00194     std::cerr << \textcolor{stringliteral}{"Source term could not be written to disk."} << std::endl;
00195     \textcolor{keywordflow}{return} EXIT\_FAILURE;
00196   \}
00197 
00199   \textcolor{keywordtype}{int} info\{\hyperlink{classmtk_1_1LAPACKAdapter_a7428bccf74fd4a4af68fb7233846da22}{mtk::LAPACKAdapter::SolveDenseSystem}(lapm, source)\};
00200 
00201   \textcolor{keywordflow}{if} (!info) \{
00202     std::cout << \textcolor{stringliteral}{"System solved."} << std::endl;
00203     std::cout << std::endl;
00204   \} \textcolor{keywordflow}{else} \{
00205     std::cerr << \textcolor{stringliteral}{"Something wrong solving system! info = "} << info << std::endl;
00206     std::cerr << \textcolor{stringliteral}{"Exiting..."} << std::endl;
00207     \textcolor{keywordflow}{return} EXIT\_FAILURE;
00208   \}
00209 
00210   \textcolor{keywordflow}{if} (!source.WriteToFile(\textcolor{stringliteral}{"poisson\_2d\_comp\_sol.dat"}, \textcolor{stringliteral}{"x"}, \textcolor{stringliteral}{"y"}, \textcolor{stringliteral}{"~u(x,y)"})) \{
00211     std::cerr << \textcolor{stringliteral}{"Solution could not be written to file."} << std::endl;
00212     \textcolor{keywordflow}{return} EXIT\_FAILURE;
00213   \}
00214 
00216   \hyperlink{classmtk_1_1UniStgGrid2D}{mtk::UniStgGrid2D} known\_sol(west\_bndy\_x, east\_bndy\_x, num\_cells\_x,
00217                               south\_bndy\_y, north\_bndy\_y, num\_cells\_y);
00218 
00219   known\_sol.BindScalarField(KnownSolution);
00220 
00221   \textcolor{keywordflow}{if} (!known\_sol.WriteToFile(\textcolor{stringliteral}{"poisson\_2d\_known\_sol.dat"}, \textcolor{stringliteral}{"x"}, \textcolor{stringliteral}{"y"}, \textcolor{stringliteral}{"u(x,y)"})) \{
00222     std::cerr << \textcolor{stringliteral}{"Known solution could not be written to file."} << std::endl;
00223     \textcolor{keywordflow}{return} EXIT\_FAILURE;
00224   \}
00225 
00226   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} relative\_norm\_2\_error\{\};
00227 
00228   relative\_norm\_2\_error =
00229     \hyperlink{classmtk_1_1BLASAdapter_af2ac5691f45e67d6e26186b071119ec4}{mtk::BLASAdapter::RelNorm2Error}(source.discrete\_field(),
00230                                     known\_sol.discrete\_field(),
00231                                     known\_sol.Size());
00232 
00233   std::cout << \textcolor{stringliteral}{"relative\_norm\_2\_error = "};
00234   std::cout << relative\_norm\_2\_error << std::endl;
00235 \}
00236 
00237 \textcolor{preprocessor}{#else}
00238 \textcolor{preprocessor}{#include <iostream>}
00239 \textcolor{keyword}{using} std::cout;
00240 \textcolor{keyword}{using} std::endl;
\hypertarget{poisson__2d_8cc_source_l00241}{}\hyperlink{poisson__2d_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{00241} \textcolor{keywordtype}{int} \hyperlink{poisson__2d_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main} () \{
00242   cout << \textcolor{stringliteral}{"This code HAS to be compiled with support for C++11."} << endl;
00243   cout << \textcolor{stringliteral}{"Exiting..."} << endl;
00244   \textcolor{keywordflow}{return} EXIT\_SUCCESS;
00245 \}
00246 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
