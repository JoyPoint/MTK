\hypertarget{mtk__grad__2d_8cc_source}{\section{mtk\+\_\+grad\+\_\+2d.\+cc}
\label{mtk__grad__2d_8cc_source}\index{src/mtk\+\_\+grad\+\_\+2d.\+cc@{src/mtk\+\_\+grad\+\_\+2d.\+cc}}
}

\begin{DoxyCode}
00001 
00011 \textcolor{comment}{/*}
00012 \textcolor{comment}{Copyright (C) 2015, Computational Science Research Center, San Diego State}
00013 \textcolor{comment}{University. All rights reserved.}
00014 \textcolor{comment}{}
00015 \textcolor{comment}{Redistribution and use in source and binary forms, with or without modification,}
00016 \textcolor{comment}{are permitted provided that the following conditions are met:}
00017 \textcolor{comment}{}
00018 \textcolor{comment}{1. Modifications to source code should be reported to: esanchez@mail.sdsu.edu}
00019 \textcolor{comment}{and a copy of the modified files should be reported once modifications are}
00020 \textcolor{comment}{completed, unless these modifications are made through the project's GitHub}
00021 \textcolor{comment}{page: http://www.csrc.sdsu.edu/mtk. Documentation related to said modifications}
00022 \textcolor{comment}{should be developed and included in any deliverable.}
00023 \textcolor{comment}{}
00024 \textcolor{comment}{2. Redistributions of source code must be done through direct}
00025 \textcolor{comment}{downloads from the project's GitHub page: http://www.csrc.sdsu.edu/mtk}
00026 \textcolor{comment}{}
00027 \textcolor{comment}{3. Redistributions in binary form must reproduce the above copyright notice,}
00028 \textcolor{comment}{this list of conditions and the following disclaimer in the documentation and/or}
00029 \textcolor{comment}{other materials provided with the distribution.}
00030 \textcolor{comment}{}
00031 \textcolor{comment}{4. Usage of the binary form on proprietary applications shall require explicit}
00032 \textcolor{comment}{prior written permission from the the copyright holders, and due credit should}
00033 \textcolor{comment}{be given to the copyright holders.}
00034 \textcolor{comment}{}
00035 \textcolor{comment}{5. Neither the name of the copyright holder nor the names of its contributors}
00036 \textcolor{comment}{may be used to endorse or promote products derived from this software without}
00037 \textcolor{comment}{specific prior written permission.}
00038 \textcolor{comment}{}
00039 \textcolor{comment}{The copyright holders provide no reassurances that the source code provided does}
00040 \textcolor{comment}{not infringe any patent, copyright, or any other intellectual property rights of}
00041 \textcolor{comment}{third parties. The copyright holders disclaim any liability to any recipient for}
00042 \textcolor{comment}{claims brought against recipient by any third party for infringement of that}
00043 \textcolor{comment}{parties intellectual property rights.}
00044 \textcolor{comment}{}
00045 \textcolor{comment}{THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND}
00046 \textcolor{comment}{ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED}
00047 \textcolor{comment}{WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00048 \textcolor{comment}{DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR}
00049 \textcolor{comment}{ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES}
00050 \textcolor{comment}{(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;}
00051 \textcolor{comment}{LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON}
00052 \textcolor{comment}{ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT}
00053 \textcolor{comment}{(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS}
00054 \textcolor{comment}{SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00055 \textcolor{comment}{*/}
00056 
00057 \textcolor{preprocessor}{#include <cstdlib>}
00058 \textcolor{preprocessor}{#include <cstdio>}
00059 
00060 \textcolor{preprocessor}{#include <iostream>}
00061 \textcolor{preprocessor}{#include <iomanip>}
00062 
00063 \textcolor{preprocessor}{#include "\hyperlink{mtk__roots_8h}{mtk\_roots.h}"}
00064 \textcolor{preprocessor}{#include "\hyperlink{mtk__grad__1d_8h}{mtk\_grad\_1d.h}"}
00065 \textcolor{preprocessor}{#include "\hyperlink{mtk__grad__2d_8h}{mtk\_grad\_2d.h}"}
00066 
\hypertarget{mtk__grad__2d_8cc_source_l00067}{}\hyperlink{classmtk_1_1Grad2D_a15bdca254b7bf662913b34c7afb8d4c9}{00067} \hyperlink{classmtk_1_1Grad2D_a15bdca254b7bf662913b34c7afb8d4c9}{mtk::Grad2D::Grad2D}():
00068   order\_accuracy\_(),
00069   mimetic\_threshold\_() \{\}
00070 
\hypertarget{mtk__grad__2d_8cc_source_l00071}{}\hyperlink{classmtk_1_1Grad2D_a31ccf118edb128c85f28b579bd9394a8}{00071} \hyperlink{classmtk_1_1Grad2D_a15bdca254b7bf662913b34c7afb8d4c9}{mtk::Grad2D::Grad2D}(\textcolor{keyword}{const} \hyperlink{classmtk_1_1Grad2D}{Grad2D} &grad):
00072   order\_accuracy\_(grad.order\_accuracy\_),
00073   mimetic\_threshold\_(grad.mimetic\_threshold\_) \{\}
00074 
\hypertarget{mtk__grad__2d_8cc_source_l00075}{}\hyperlink{classmtk_1_1Grad2D_ae6a071b24422d057c41346e80be96cb3}{00075} \hyperlink{classmtk_1_1Grad2D_ae6a071b24422d057c41346e80be96cb3}{mtk::Grad2D::~Grad2D}() \{\}
00076 
\hypertarget{mtk__grad__2d_8cc_source_l00077}{}\hyperlink{classmtk_1_1Grad2D_a9771be954c59880e3d83f4d645378c00}{00077} \textcolor{keywordtype}{bool} \hyperlink{classmtk_1_1Grad2D_a9771be954c59880e3d83f4d645378c00}{mtk::Grad2D::ConstructGrad2D}(\textcolor{keyword}{const} 
      \hyperlink{classmtk_1_1UniStgGrid2D}{mtk::UniStgGrid2D} &grid,
00078                                   \textcolor{keywordtype}{int} order\_accuracy,
00079                                   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} mimetic\_threshold) \{
00080 
00081   \textcolor{keywordtype}{int} num\_cells\_x = grid.\hyperlink{classmtk_1_1UniStgGrid2D_a2d182866a398aba8e4829590e85bf939}{num\_cells\_x}();
00082   \textcolor{keywordtype}{int} num\_cells\_y = grid.\hyperlink{classmtk_1_1UniStgGrid2D_aed05a801cc9a76dba0ff203cea58a61a}{num\_cells\_y}();
00083 
00084   \textcolor{keywordtype}{int} mx = num\_cells\_x + 1;  \textcolor{comment}{// Gx vertical dimension}
00085   \textcolor{keywordtype}{int} nx = num\_cells\_x + 2;  \textcolor{comment}{// Gx horizontal dimension}
00086   \textcolor{keywordtype}{int} my = num\_cells\_y + 1;  \textcolor{comment}{// Gy vertical dimension}
00087   \textcolor{keywordtype}{int} ny = num\_cells\_y + 2;  \textcolor{comment}{// Gy horizontal dimension}
00088 
00089   \hyperlink{classmtk_1_1Grad1D}{mtk::Grad1D} grad;
00090 
00091   \textcolor{keywordtype}{bool} info = grad.\hyperlink{classmtk_1_1Grad1D_a74ef5245cfae6fd158bd7f563a0c2e52}{ConstructGrad1D}(order\_accuracy, mimetic\_threshold);
00092 
00093   \textcolor{keywordflow}{if} (!info) \{
00094     std::cerr << \textcolor{stringliteral}{"Mimetic grad could not be built."} << std::endl;
00095     \textcolor{keywordflow}{return} info;
00096   \}
00097 
00098   \textcolor{keyword}{auto} west = grid.\hyperlink{classmtk_1_1UniStgGrid2D_af2b1712387ded85edaf2b64617d3fc13}{west\_bndy}();
00099   \textcolor{keyword}{auto} east = grid.\hyperlink{classmtk_1_1UniStgGrid2D_a03f689eb29a6369b82ce1207c655d5ff}{east\_bndy}();
00100   \textcolor{keyword}{auto} south = grid.\hyperlink{classmtk_1_1UniStgGrid2D_a1442eaf219f099d0ebf46a170fdebf92}{south\_bndy}();
00101   \textcolor{keyword}{auto} north = grid.\hyperlink{classmtk_1_1UniStgGrid2D_a03f689eb29a6369b82ce1207c655d5ff}{east\_bndy}();
00102 
00103   \hyperlink{classmtk_1_1UniStgGrid1D}{mtk::UniStgGrid1D} grid\_x(west, east, num\_cells\_x);
00104   \hyperlink{classmtk_1_1UniStgGrid1D}{mtk::UniStgGrid1D} grid\_y(south, north, num\_cells\_y);
00105 
00106   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} Gx(grad.\hyperlink{classmtk_1_1Grad1D_a4218516bfb43f683559322ea97058c78}{ReturnAsDenseMatrix}(grid\_x));
00107   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} Gy(grad.\hyperlink{classmtk_1_1Grad1D_a4218516bfb43f683559322ea97058c78}{ReturnAsDenseMatrix}(grid\_y));
00108 
00109   \textcolor{keywordtype}{bool} padded\{\textcolor{keyword}{true}\};
00110   \textcolor{keywordtype}{bool} transpose\{\textcolor{keyword}{true}\};
00111 
00112   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} tix(num\_cells\_x, padded, transpose);
00113   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} tiy(num\_cells\_y, padded, transpose);
00114 
00115   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} gxy(\hyperlink{classmtk_1_1DenseMatrix_a01d3d8bd502870f93bf3a88a0cc5fb49}{mtk::DenseMatrix::Kron}(tiy, Gx));
00116   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} gyx(\hyperlink{classmtk_1_1DenseMatrix_a01d3d8bd502870f93bf3a88a0cc5fb49}{mtk::DenseMatrix::Kron}(Gy, tix));
00117 
00118 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00119   std::cout << \textcolor{stringliteral}{"Gx :"} << mx << \textcolor{stringliteral}{"by "} << nx << std::endl;
00120   std::cout << \textcolor{stringliteral}{"Transpose Iy : "} << num\_cells\_y<< \textcolor{stringliteral}{" by "} << ny  << std::endl;
00121   std::cout << \textcolor{stringliteral}{"Gy :"} << my << \textcolor{stringliteral}{"by "} << ny << std::endl;
00122   std::cout << \textcolor{stringliteral}{"Transpose Ix : "} << num\_cells\_x<< \textcolor{stringliteral}{" by "} << nx  << std::endl;
00123   std::cout << \textcolor{stringliteral}{"Kronecker dimensions Grad 2D"} <<
00124     mx*num\_cells\_y + my*num\_cells\_x << \textcolor{stringliteral}{" by "} <<  nx*ny <<std::endl;
00125 \textcolor{preprocessor}{  #endif}
00126 
00127   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} g2d(mx*num\_cells\_y + my*num\_cells\_x, nx*ny);
00128 
00129   \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} ii = 0; ii < nx*ny; ii++) \{
00130     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} jj = 0; jj < mx*num\_cells\_y; jj++) \{
00131       g2d.\hyperlink{classmtk_1_1DenseMatrix_ae0f873a6d3a734da467cafb817da64ae}{SetValue}(jj,ii, gxy.\hyperlink{classmtk_1_1DenseMatrix_a87fb785713c04b13767947cc3325ce7c}{GetValue}(jj,ii));
00132     \}
00133     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} kk = 0; kk < my*num\_cells\_x; kk++) \{
00134       g2d.\hyperlink{classmtk_1_1DenseMatrix_ae0f873a6d3a734da467cafb817da64ae}{SetValue}(kk + mx*num\_cells\_y, ii, gyx.\hyperlink{classmtk_1_1DenseMatrix_a87fb785713c04b13767947cc3325ce7c}{GetValue}(kk,ii));
00135     \}
00136   \}
00137 
00138   gradient\_ = g2d;
00139 
00140   \textcolor{keywordflow}{return} info;
00141 \}
00142 
\hypertarget{mtk__grad__2d_8cc_source_l00143}{}\hyperlink{classmtk_1_1Grad2D_afa14fa1b84f05752027c1cef66381de8}{00143} \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} \hyperlink{classmtk_1_1Grad2D_afa14fa1b84f05752027c1cef66381de8}{mtk::Grad2D::ReturnAsDenseMatrix}() \{
00144 
00145   \textcolor{keywordflow}{return} gradient\_;
00146 \}
\end{DoxyCode}
