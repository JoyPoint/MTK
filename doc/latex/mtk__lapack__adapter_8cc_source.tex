\hypertarget{mtk__lapack__adapter_8cc}{\section{mtk\-\_\-lapack\-\_\-adapter.\-cc}
\label{mtk__lapack__adapter_8cc}\index{src/mtk\-\_\-lapack\-\_\-adapter.\-cc@{src/mtk\-\_\-lapack\-\_\-adapter.\-cc}}
}

\begin{DoxyCode}
00001 
00018 \textcolor{comment}{/*}
00019 \textcolor{comment}{Copyright (C) 2015, Computational Science Research Center, San Diego State}
00020 \textcolor{comment}{University. All rights reserved.}
00021 \textcolor{comment}{}
00022 \textcolor{comment}{Redistribution and use in source and binary forms, with or without modification,}
00023 \textcolor{comment}{are permitted provided that the following conditions are met:}
00024 \textcolor{comment}{}
00025 \textcolor{comment}{1. Modifications to source code should be reported to: esanchez@mail.sdsu.edu}
00026 \textcolor{comment}{and a copy of the modified files should be reported once modifications are}
00027 \textcolor{comment}{completed. Documentation related to said modifications should be included.}
00028 \textcolor{comment}{}
00029 \textcolor{comment}{2. Redistributions of source code must be done through direct}
00030 \textcolor{comment}{downloads from the project's GitHub page: http://www.csrc.sdsu.edu/mtk}
00031 \textcolor{comment}{}
00032 \textcolor{comment}{3. Redistributions of source code must retain the above copyright notice, this}
00033 \textcolor{comment}{list of conditions and the following disclaimer.}
00034 \textcolor{comment}{}
00035 \textcolor{comment}{4. Redistributions in binary form must reproduce the above copyright notice,}
00036 \textcolor{comment}{this list of conditions and the following disclaimer in the documentation and/or}
00037 \textcolor{comment}{other materials provided with the distribution.}
00038 \textcolor{comment}{}
00039 \textcolor{comment}{5. Usage of the binary form on proprietary applications shall require explicit}
00040 \textcolor{comment}{prior written permission from the the copyright holders.}
00041 \textcolor{comment}{}
00042 \textcolor{comment}{6. Neither the name of the copyright holder nor the names of its contributors}
00043 \textcolor{comment}{may be used to endorse or promote products derived from this software without}
00044 \textcolor{comment}{specific prior written permission.}
00045 \textcolor{comment}{}
00046 \textcolor{comment}{The copyright holders provide no reassurances that the source code provided does}
00047 \textcolor{comment}{not infringe any patent, copyright, or any other intellectual property rights of}
00048 \textcolor{comment}{third parties. The copyright holders disclaim any liability to any recipient for}
00049 \textcolor{comment}{claims brought against recipient by any third party for infringement of that}
00050 \textcolor{comment}{parties intellectual property rights.}
00051 \textcolor{comment}{}
00052 \textcolor{comment}{THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND}
00053 \textcolor{comment}{ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED}
00054 \textcolor{comment}{WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE}
00055 \textcolor{comment}{DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR}
00056 \textcolor{comment}{ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES}
00057 \textcolor{comment}{(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;}
00058 \textcolor{comment}{LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON}
00059 \textcolor{comment}{ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT}
00060 \textcolor{comment}{(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS}
00061 \textcolor{comment}{SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}
00062 \textcolor{comment}{*/}
00063 
00064 \textcolor{preprocessor}{#include <cstring>}
00065 
00066 \textcolor{preprocessor}{#include <iostream>}
00067 \textcolor{preprocessor}{#include <iomanip>}
00068 
00069 \textcolor{preprocessor}{#include <algorithm>}
00070 
00071 \textcolor{preprocessor}{#include "\hyperlink{mtk__tools_8h}{mtk\_tools.h}"}
00072 \textcolor{preprocessor}{#include "\hyperlink{mtk__dense__matrix_8h}{mtk\_dense\_matrix.h}"}
00073 \textcolor{preprocessor}{#include "\hyperlink{mtk__lapack__adapter_8h}{mtk\_lapack\_adapter.h}"}
00074 
00075 \textcolor{keyword}{namespace }mtk \{
00076 
00077 \textcolor{keyword}{extern} \textcolor{stringliteral}{"C"} \{
00078 
00079 \textcolor{preprocessor}{#ifdef MTK\_PRECISION\_DOUBLE}
00080 \textcolor{preprocessor}{}
00099 \textcolor{keywordtype}{void} dgesv\_(\textcolor{keywordtype}{int}* n,
00100             \textcolor{keywordtype}{int}* nrhs,
00101             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* a,
00102             \textcolor{keywordtype}{int}* lda,
00103             \textcolor{keywordtype}{int}* ipiv,
00104             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* b,
00105             \textcolor{keywordtype}{int}* ldb,
00106             \textcolor{keywordtype}{int}* info);
00107 \textcolor{preprocessor}{#else}
00108 \textcolor{preprocessor}{}
00127 \textcolor{keywordtype}{void} \hyperlink{namespacemtk_ae1d63c7ae73b3c48e0dca81eb19039f3}{sgesv\_}(\textcolor{keywordtype}{int}* n,
00128             \textcolor{keywordtype}{int}* nrhs,
00129             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* a,
00130             \textcolor{keywordtype}{int}* lda,
00131             \textcolor{keywordtype}{int}* ipiv,
00132             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* b,
00133             \textcolor{keywordtype}{int}* ldb,
00134             \textcolor{keywordtype}{int}* info);
00135 \textcolor{preprocessor}{#endif}
00136 \textcolor{preprocessor}{}
00137 \textcolor{preprocessor}{#ifdef MTK\_PRECISION\_DOUBLE}
00138 \textcolor{preprocessor}{}
00181 \textcolor{keywordtype}{void} dgels\_(\textcolor{keywordtype}{char}* trans,
00182             \textcolor{keywordtype}{int}* m,
00183             \textcolor{keywordtype}{int}* n,
00184             \textcolor{keywordtype}{int}* nrhs,
00185             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* a,
00186             \textcolor{keywordtype}{int}* lda,
00187             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* b,
00188             \textcolor{keywordtype}{int}* ldb,
00189             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* work,
00190             \textcolor{keywordtype}{int}* lwork,
00191             \textcolor{keywordtype}{int}* info);
00192 \textcolor{preprocessor}{#else}
00193 \textcolor{preprocessor}{}
00236 \textcolor{keywordtype}{void} \hyperlink{namespacemtk_ada6df1b733204aa7ff0b1ec7556288f9}{sgels\_}(\textcolor{keywordtype}{char}* trans,
00237             \textcolor{keywordtype}{int}* m,
00238             \textcolor{keywordtype}{int}* n,
00239             \textcolor{keywordtype}{int}* nrhs,
00240             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* a,
00241             \textcolor{keywordtype}{int}* lda,
00242             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* b,
00243             \textcolor{keywordtype}{int}* ldb,
00244             \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real}* work,
00245             \textcolor{keywordtype}{int}* lwork,
00246             \textcolor{keywordtype}{int}* info);
00247 \textcolor{preprocessor}{#endif}
00248 \textcolor{preprocessor}{}
00249 \textcolor{preprocessor}{#ifdef MTK\_PRECISION\_DOUBLE}
00250 \textcolor{preprocessor}{}
00279 \textcolor{keywordtype}{void} dgeqrf\_(\textcolor{keywordtype}{int} *m,
00280              \textcolor{keywordtype}{int} *n,
00281              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *a,
00282              \textcolor{keywordtype}{int} *lda,
00283              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *tau,
00284              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *work,
00285              \textcolor{keywordtype}{int} *lwork,
00286              \textcolor{keywordtype}{int} *info);
00287 \textcolor{preprocessor}{#else}
00288 \textcolor{preprocessor}{}
00317 \textcolor{keywordtype}{void} \hyperlink{namespacemtk_aece7419193d8ab43e186c97ad6d529fb}{sgeqrf\_}(\textcolor{keywordtype}{int} *m,
00318              \textcolor{keywordtype}{int} *n,
00319              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *a,
00320              \textcolor{keywordtype}{int} *lda,
00321              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *tau,
00322              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *work,
00323              \textcolor{keywordtype}{int} *lwork,
00324              \textcolor{keywordtype}{int} *info);
00325 \textcolor{preprocessor}{#endif}
00326 \textcolor{preprocessor}{}
00327 \textcolor{preprocessor}{#ifdef MTK\_PRECISION\_DOUBLE}
00328 \textcolor{preprocessor}{}
00362 \textcolor{keywordtype}{void} dormqr\_(\textcolor{keywordtype}{char} *side,
00363              \textcolor{keywordtype}{char} *trans,
00364              \textcolor{keywordtype}{int} *m,
00365              \textcolor{keywordtype}{int} *n,
00366              \textcolor{keywordtype}{int} *k,
00367              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *a,
00368              \textcolor{keywordtype}{int} *lda,
00369              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *tau,
00370              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *c,
00371              \textcolor{keywordtype}{int} *ldc,
00372              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *work,
00373              \textcolor{keywordtype}{int} *lwork,
00374              \textcolor{keywordtype}{int} *info);
00375 \textcolor{preprocessor}{#else}
00376 \textcolor{preprocessor}{}
00410 \textcolor{keywordtype}{void} \hyperlink{namespacemtk_a59c58408e1c0a9837b67a417be986b82}{sormqr\_}(\textcolor{keywordtype}{char} *side,
00411              \textcolor{keywordtype}{char} *trans,
00412              \textcolor{keywordtype}{int} *m,
00413              \textcolor{keywordtype}{int} *n,
00414              \textcolor{keywordtype}{int} *k,
00415              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *a,
00416              \textcolor{keywordtype}{int} *lda,
00417              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *tau,
00418              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *c,
00419              \textcolor{keywordtype}{int} *ldc,
00420              \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{Real} *work,
00421              \textcolor{keywordtype}{int} *lwork,
00422              \textcolor{keywordtype}{int} *info);
00423 \textcolor{preprocessor}{#endif}
00424 \textcolor{preprocessor}{}\}
00425 \}
00426 
\hypertarget{mtk__lapack__adapter_8cc_source_l00427}{}\hyperlink{classmtk_1_1LAPACKAdapter_a7428bccf74fd4a4af68fb7233846da22}{00427} \textcolor{keywordtype}{int} \hyperlink{classmtk_1_1LAPACKAdapter_a7428bccf74fd4a4af68fb7233846da22}{mtk::LAPACKAdapter::SolveDenseSystem}(
      \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} &mm,
00428                                          \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} *rhs) \{
00429 
00430 
00431 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00432 \textcolor{preprocessor}{}  \hyperlink{classmtk_1_1Tools_acbcff02946d3db565d53ecbcc459f0b5}{mtk::Tools::Prevent}(rhs == \textcolor{keyword}{nullptr}, \_\_FILE\_\_, \_\_LINE\_\_, \_\_func\_\_);
00433 \textcolor{preprocessor}{  #endif}
00434 \textcolor{preprocessor}{}
00435   \textcolor{keywordtype}{int} *ipiv\{\};                \textcolor{comment}{// Array for pivoting information.}
00436   \textcolor{keywordtype}{int} nrhs\{1\};                \textcolor{comment}{// Number of right-hand sides.}
00437   \textcolor{keywordtype}{int} info\{\};                 \textcolor{comment}{// Status of the solution.}
00438   \textcolor{keywordtype}{int} mm\_rank\{mm.\hyperlink{classmtk_1_1DenseMatrix_a17d8d3b9cc0926044b6972dd190a5c21}{num\_rows}()\}; \textcolor{comment}{// Rank of the matrix.}
00439 
00440   \textcolor{keywordflow}{try} \{
00441     ipiv = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[mm\_rank];
00442   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00443     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 <<
00444       std::endl;
00445     std::cerr << memory\_allocation\_exception.what() << std::endl;
00446   \}
00447   memset(ipiv, 0, \textcolor{keyword}{sizeof}(ipiv[0])*mm\_rank);
00448 
00449   \textcolor{keywordtype}{int} ldbb = mm\_rank;
00450   \textcolor{keywordtype}{int} mm\_ld = mm\_rank;
00451 
00452 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00453 \textcolor{preprocessor}{}  dgesv\_(&mm\_rank, &nrhs, mm.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &mm\_ld, ipiv, rhs, &ldbb, &info);
00454 \textcolor{preprocessor}{  #else}
00455 \textcolor{preprocessor}{}  fgesv\_(&mm\_rank, &nrhs, mm.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &mm\_ld, ipiv, rhs, &ldbb, &info);
00456 \textcolor{preprocessor}{  #endif}
00457 \textcolor{preprocessor}{}
00458   \textcolor{keyword}{delete} [] ipiv;
00459 
00460   \textcolor{keywordflow}{return} info;
00461 \}
00462 
\hypertarget{mtk__lapack__adapter_8cc_source_l00463}{}\hyperlink{classmtk_1_1LAPACKAdapter_af0723bba1d73450119d093b9cf1ff6f0}{00463} \textcolor{keywordtype}{int} \hyperlink{classmtk_1_1LAPACKAdapter_a7428bccf74fd4a4af68fb7233846da22}{mtk::LAPACKAdapter::SolveDenseSystem}(
      \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} &mm,
00464                                          \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} &bb) \{
00465 
00466   \textcolor{keywordtype}{int} nrhs\{bb.\hyperlink{classmtk_1_1DenseMatrix_a17d8d3b9cc0926044b6972dd190a5c21}{num\_rows}()\};  \textcolor{comment}{// Number of right-hand sides.}
00467 
00468 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00469 \textcolor{preprocessor}{}  \hyperlink{classmtk_1_1Tools_acbcff02946d3db565d53ecbcc459f0b5}{mtk::Tools::Prevent}(nrhs <= 0, \_\_FILE\_\_, \_\_LINE\_\_, \_\_func\_\_);
00470 \textcolor{preprocessor}{  #endif}
00471 \textcolor{preprocessor}{}
00472   \textcolor{keywordtype}{int} *ipiv\{\};                \textcolor{comment}{// Array for pivoting information.}
00473   \textcolor{keywordtype}{int} info\{\};                 \textcolor{comment}{// Status of the solution.}
00474   \textcolor{keywordtype}{int} mm\_rank\{mm.\hyperlink{classmtk_1_1DenseMatrix_a17d8d3b9cc0926044b6972dd190a5c21}{num\_rows}()\}; \textcolor{comment}{// Rank of the matrix.}
00475 
00476   \textcolor{keywordflow}{try} \{
00477     ipiv = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[mm\_rank];
00478   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00479     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 <<
00480       std::endl;
00481     std::cerr << memory\_allocation\_exception.what() << std::endl;
00482   \}
00483   memset(ipiv, 0, \textcolor{keyword}{sizeof}(ipiv[0])*mm\_rank);
00484 
00485   \textcolor{keywordtype}{int} ldbb = mm\_rank;
00486   \textcolor{keywordtype}{int} mm\_ld = mm\_rank;
00487 
00488 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00489 \textcolor{preprocessor}{}  dgesv\_(&mm\_rank, &nrhs, mm.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &mm\_ld, ipiv, bb.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &ldbb, &info);
00490 \textcolor{preprocessor}{  #else}
00491 \textcolor{preprocessor}{}  fgesv\_(&mm\_rank, &nrhs, mm.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &mm\_ld, ipiv, bb.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &ldbb, &info);
00492 \textcolor{preprocessor}{  #endif}
00493 \textcolor{preprocessor}{}
00494   \textcolor{keyword}{delete} [] ipiv;
00495 
00496   \textcolor{comment}{// After output, the data in the matrix will be column-major ordered.}
00497 
00498   bb.\hyperlink{classmtk_1_1DenseMatrix_aacae136ae446cad8f0d81476e83efb39}{SetOrdering}(\hyperlink{namespacemtk_ga622801bd9f912d0f976c3e383f5f581ca7c11989c132253fb76b8f6b1314f7e13}{mtk::COL\_MAJOR});
00499 
00500 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00501 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"bb\_col\_maj\_ord ="} << std::endl;
00502   std::cout << bb << std::endl;
00503 \textcolor{preprocessor}{  #endif}
00504 \textcolor{preprocessor}{}
00505   bb.\hyperlink{classmtk_1_1DenseMatrix_ac2949efba3e8278335d45418c85433e4}{OrderRowMajor}();
00506 
00507 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00508 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"bb\_row\_maj\_ord ="} << std::endl;
00509   std::cout << bb << std::endl;
00510 \textcolor{preprocessor}{  #endif}
00511 \textcolor{preprocessor}{}
00512   \textcolor{keywordflow}{return} info;
00513 \}
00514 
\hypertarget{mtk__lapack__adapter_8cc_source_l00515}{}\hyperlink{classmtk_1_1LAPACKAdapter_ae5c6e78c9c819c9ac7a6f31bfd011d7a}{00515} \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} \hyperlink{classmtk_1_1LAPACKAdapter_ae5c6e78c9c819c9ac7a6f31bfd011d7a}{mtk::LAPACKAdapter::QRFactorDenseMatrix}
      (\hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} &aa) \{
00516 
00517   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} *work\{\}; \textcolor{comment}{// Working array.}
00518   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} *tau\{\};  \textcolor{comment}{// Array for the Householder scalars.}
00519 
00520   \textcolor{comment}{// Prepare to factorize: allocate and inquire for the value of lwork.}
00521   \textcolor{keywordflow}{try} \{
00522     work = \textcolor{keyword}{new} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real}[1];
00523   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00524     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 <<
00525       std::endl;
00526     std::cerr << memory\_allocation\_exception.what() << std::endl;
00527   \}
00528   memset(work, \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero}, \textcolor{keyword}{sizeof}(aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}()[0])*1);
00529 
00530   \textcolor{keywordtype}{int} lwork\{-1\};
00531   \textcolor{keywordtype}{int} info\{\};
00532 
00533   \textcolor{keywordtype}{int} aa\_num\_cols = aa.\hyperlink{classmtk_1_1DenseMatrix_af6f78373aaf2136f0c78974d7c8de0a8}{num\_cols}();
00534   \textcolor{keywordtype}{int} aaT\_num\_rows = aa.\hyperlink{classmtk_1_1DenseMatrix_af6f78373aaf2136f0c78974d7c8de0a8}{num\_cols}();
00535   \textcolor{keywordtype}{int} aaT\_num\_cols = aa.\hyperlink{classmtk_1_1DenseMatrix_a17d8d3b9cc0926044b6972dd190a5c21}{num\_rows}();
00536 
00537 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00538 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"Input matrix BEFORE QR factorization:"} << std::endl;
00539   std::cout << aa << std::endl;
00540 \textcolor{preprocessor}{  #endif}
00541 \textcolor{preprocessor}{}
00542 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00543 \textcolor{preprocessor}{}  dgeqrf\_(&aaT\_num\_rows, &aaT\_num\_cols, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows,
00544           tau,
00545           work, &lwork, &info);
00546 \textcolor{preprocessor}{  #else}
00547 \textcolor{preprocessor}{}  fgeqrf\_(&aaT\_num\_rows, &aaT\_num\_cols, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows,
00548           tau,
00549           work, &lwork, &info);
00550 \textcolor{preprocessor}{  #endif}
00551 \textcolor{preprocessor}{}
00552 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00553 \textcolor{preprocessor}{}  \textcolor{keywordflow}{if} (info == 0) \{
00554     lwork = (int) work[0];
00555   \} \textcolor{keywordflow}{else} \{
00556     std::cerr << \textcolor{stringliteral}{"Could not get value for lwork on line "} << \_\_LINE\_\_ - 5 <<
00557       std::endl;
00558     std::cerr << \textcolor{stringliteral}{"Exiting..."} << std::endl;
00559   \}
00560 \textcolor{preprocessor}{  #endif}
00561 \textcolor{preprocessor}{}
00562 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL>0}
00563 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"lwork = "} << std::endl << std::setw(12) << lwork << std::endl
00564     << std::endl;
00565 \textcolor{preprocessor}{  #endif}
00566 \textcolor{preprocessor}{}
00567   \textcolor{keyword}{delete} [] work;
00568   work = \textcolor{keyword}{nullptr};
00569 
00570   \textcolor{comment}{// Once we know lwork, we can actually invoke the factorization:}
00571   \textcolor{keywordflow}{try} \{
00572     work = \textcolor{keyword}{new} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} [lwork];
00573   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00574     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 <<
00575       std::endl;
00576     std::cerr << memory\_allocation\_exception.what() << std::endl;
00577   \}
00578   memset(work, \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero}, \textcolor{keyword}{sizeof}(work[0])*lwork);
00579 
00580   \textcolor{keywordtype}{int} ltau = std::min(aaT\_num\_rows,aaT\_num\_cols);
00581 
00582   \textcolor{keywordflow}{try} \{
00583     tau = \textcolor{keyword}{new} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} [ltau];
00584   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00585     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 <<
00586       std::endl;
00587     std::cerr << memory\_allocation\_exception.what() << std::endl;
00588   \}
00589   memset(tau, \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero}, \textcolor{keyword}{sizeof}(0.0)*ltau);
00590 
00591 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00592 \textcolor{preprocessor}{}  dgeqrf\_(&aaT\_num\_rows, &aaT\_num\_cols, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows,
00593           tau, work, &lwork, &info);
00594 \textcolor{preprocessor}{  #else}
00595 \textcolor{preprocessor}{}  fgeqrf\_(&aaT\_num\_rows, &aaT\_num\_cols, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows,
00596           tau, work, &lwork, &info);
00597 \textcolor{preprocessor}{  #endif}
00598 \textcolor{preprocessor}{}
00599   \textcolor{keywordflow}{if} (!info) \{
00600 \textcolor{preprocessor}{    #if MTK\_DEBUG\_LEVEL > 0}
00601 \textcolor{preprocessor}{}    std::cout << \textcolor{stringliteral}{"QR factorization completed!"} << std::endl << std::endl;
00602 \textcolor{preprocessor}{    #endif}
00603 \textcolor{preprocessor}{}  \} \textcolor{keywordflow}{else} \{
00604     std::cerr << \textcolor{stringliteral}{"Error solving system! info = "} << info << std::endl;
00605     std::cerr << \textcolor{stringliteral}{"Exiting..."} << std::endl;
00606   \}
00607 
00608 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00609 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"Input matrix AFTER QR factorization:"} << std::endl;
00610   std::cout << aa << std::endl;
00611 \textcolor{preprocessor}{  #endif}
00612 \textcolor{preprocessor}{}
00613   \textcolor{comment}{// We now generate the real matrix Q with orthonormal columns. This has to}
00614   \textcolor{comment}{// be done separately since the actual output of dgeqrf\_ (AA\_) represents}
00615   \textcolor{comment}{// the orthogonal matrix Q as a product of min(aa\_num\_rows,aa\_num\_cols)}
00616   \textcolor{comment}{// elementary Householder reflectors. Notice that we must re-inquire the new}
00617   \textcolor{comment}{// value for lwork that is used.}
00618 
00619   \textcolor{keywordtype}{bool} padded\{\textcolor{keyword}{false}\};
00620 
00621   \textcolor{keywordtype}{bool} transpose\{\textcolor{keyword}{false}\};
00622 
00623   \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} QQ\_(aa.\hyperlink{classmtk_1_1DenseMatrix_af6f78373aaf2136f0c78974d7c8de0a8}{num\_cols}(),padded,transpose);
00624 
00625 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00626 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"Initialized QQ\_T: "} << std::endl;
00627   std::cout << QQ\_ << std::endl;
00628 \textcolor{preprocessor}{  #endif}
00629 \textcolor{preprocessor}{}
00630   \textcolor{comment}{// Assemble the QQ\_ matrix:}
00631   lwork = -1;
00632 
00633   \textcolor{keyword}{delete}[] work;
00634   work = \textcolor{keyword}{nullptr};
00635 
00636   \textcolor{keywordflow}{try} \{
00637     work = \textcolor{keyword}{new} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real}[1];
00638   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00639     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 <<
00640       std::endl;
00641     std::cerr << memory\_allocation\_exception.what() <<
00642       std::endl;
00643   \}
00644   memset(work, \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero}, \textcolor{keyword}{sizeof}(work[0])*1);
00645 
00646   \textcolor{keywordtype}{char} side\_\{\textcolor{charliteral}{'L'}\};
00647   \textcolor{keywordtype}{char} trans\_\{\textcolor{charliteral}{'N'}\};
00648 
00649   \textcolor{keywordtype}{int} aux = QQ\_.num\_rows();
00650 
00651 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00652 \textcolor{preprocessor}{}  dormqr\_(&side\_, &trans\_,
00653           &aa\_num\_cols, &aa\_num\_cols, &ltau, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows, tau,
00654           QQ\_.data(), &aux, work, &lwork, &info);
00655 \textcolor{preprocessor}{  #else}
00656 \textcolor{preprocessor}{}  formqr\_(&side\_, &trans\_,
00657           &aa\_num\_cols, &aa\_num\_cols, &ltau, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows, tau,
00658           QQ\_.data(), &aux, work, &lwork, &info);
00659 \textcolor{preprocessor}{  #endif}
00660 \textcolor{preprocessor}{}
00661 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00662 \textcolor{preprocessor}{}  \textcolor{keywordflow}{if} (info == 0) \{
00663     lwork = (int) work[0];
00664   \} \textcolor{keywordflow}{else} \{
00665     std::cerr << \textcolor{stringliteral}{"Could not get lwork on line "} << \_\_LINE\_\_ - 5 << std::endl;
00666     std::cerr << \textcolor{stringliteral}{"Exiting..."} << std::endl;
00667   \}
00668 \textcolor{preprocessor}{  #endif}
00669 \textcolor{preprocessor}{}
00670 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00671 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"lwork = "} << std::endl << std::setw(12) << lwork <<
00672     std::endl << std::endl;
00673 \textcolor{preprocessor}{  #endif}
00674 \textcolor{preprocessor}{}
00675   \textcolor{keyword}{delete}[] work;
00676   work = \textcolor{keyword}{nullptr};
00677 
00678   \textcolor{keywordflow}{try} \{
00679     work = \textcolor{keyword}{new} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real}[lwork];
00680   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00681     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 <<
00682       std::endl;
00683     std::cerr << memory\_allocation\_exception.what() << std::endl;
00684   \}
00685   memset(work, \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero}, \textcolor{keyword}{sizeof}(work[0])*lwork);
00686 
00687 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00688 \textcolor{preprocessor}{}  dormqr\_(&side\_, &trans\_,
00689           &aa\_num\_cols, &aa\_num\_cols, &ltau, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows, tau,
00690           QQ\_.data(), &aux, work, &lwork, &info);
00691 \textcolor{preprocessor}{  #else}
00692 \textcolor{preprocessor}{}  formqr\_(&side\_, &trans\_,
00693           &aa\_num\_cols, &aa\_num\_cols, &ltau, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &aaT\_num\_rows, tau,
00694           QQ\_.data(), &aux, work, &lwork, &info);
00695 \textcolor{preprocessor}{  #endif}
00696 \textcolor{preprocessor}{}
00697   \textcolor{keywordflow}{if} (!info) \{
00698 \textcolor{preprocessor}{    #if MTK\_DEBUG\_LEVEL>0}
00699 \textcolor{preprocessor}{}    std::cout << \textcolor{stringliteral}{"Q matrix successfully assembled!"} << std::endl << std::endl;
00700 \textcolor{preprocessor}{    #endif}
00701 \textcolor{preprocessor}{}  \} \textcolor{keywordflow}{else} \{
00702     std::cerr << \textcolor{stringliteral}{"Something went wrong solving system! info = "} << info <<
00703       std::endl;
00704     std::cerr << \textcolor{stringliteral}{"Exiting..."} << std::endl;
00705   \}
00706 
00707   \textcolor{keyword}{delete}[] work;
00708   work = \textcolor{keyword}{nullptr};
00709 
00710   \textcolor{keyword}{delete}[] tau;
00711   tau = \textcolor{keyword}{nullptr};
00712 
00713   \textcolor{keywordflow}{return} QQ\_;
00714 \}
00715 
\hypertarget{mtk__lapack__adapter_8cc_source_l00716}{}\hyperlink{classmtk_1_1LAPACKAdapter_a380f148ffdf96bae2f79ae28f1a6560c}{00716} \textcolor{keywordtype}{int} \hyperlink{classmtk_1_1LAPACKAdapter_a380f148ffdf96bae2f79ae28f1a6560c}{mtk::LAPACKAdapter::SolveRectangularDenseSystem}(\textcolor{keyword}{const} 
      \hyperlink{classmtk_1_1DenseMatrix}{mtk::DenseMatrix} &aa,
00717                                                    \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} *ob\_,
00718                                                    \textcolor{keywordtype}{int} ob\_ld\_) \{
00719 
00720   \textcolor{comment}{// We first invoke the solver to query for the value of lwork. For this,}
00721   \textcolor{comment}{// we must at least allocate enough space to allow access to WORK(1), or}
00722   \textcolor{comment}{// work[0]:}
00723 
00724   \textcolor{comment}{// If LWORK = -1, then a workspace query is assumed; the routine only}
00725   \textcolor{comment}{// calculates the optimal size of the WORK array, returns this value as}
00726   \textcolor{comment}{// the first entry of the WORK array, and no error message related to}
00727   \textcolor{comment}{// LWORK is issued by XERBLA.}
00728 
00729   \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real} *work\{\}; \textcolor{comment}{// Work array.}
00730 
00731   \textcolor{keywordflow}{try} \{
00732     work = \textcolor{keyword}{new} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real}[1];
00733   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00734     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 << std::endl;
00735     std::cerr << memory\_allocation\_exception.what() << std::endl;
00736   \}
00737   memset(work, \hyperlink{group__c01-roots_ga59a451a5fae30d59649bcda274fea271}{mtk::kZero}, \textcolor{keyword}{sizeof}(work[0])*1);
00738 
00739   \textcolor{keywordtype}{char} trans\_\{\textcolor{charliteral}{'N'}\};
00740   \textcolor{keywordtype}{int} nrhs\_\{1\};
00741   \textcolor{keywordtype}{int} info\{0\};
00742   \textcolor{keywordtype}{int} lwork\{-1\};
00743 
00744   \textcolor{keywordtype}{int} AA\_num\_rows\_  = aa.\hyperlink{classmtk_1_1DenseMatrix_af6f78373aaf2136f0c78974d7c8de0a8}{num\_cols}();
00745   \textcolor{keywordtype}{int} AA\_num\_cols\_  = aa.\hyperlink{classmtk_1_1DenseMatrix_a17d8d3b9cc0926044b6972dd190a5c21}{num\_rows}();
00746   \textcolor{keywordtype}{int} AA\_ld\_ = std::max(1,aa.\hyperlink{classmtk_1_1DenseMatrix_af6f78373aaf2136f0c78974d7c8de0a8}{num\_cols}());
00747 
00748 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00749 \textcolor{preprocessor}{}  dgels\_(&trans\_, &AA\_num\_rows\_, &AA\_num\_cols\_, &nrhs\_, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &AA\_ld\_,
00750          ob\_, &ob\_ld\_,
00751          work, &lwork, &info);
00752 \textcolor{preprocessor}{  #else}
00753 \textcolor{preprocessor}{}  \hyperlink{namespacemtk_ada6df1b733204aa7ff0b1ec7556288f9}{sgels\_}(&trans\_, &AA\_num\_rows\_, &AA\_num\_cols\_, &nrhs\_, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &AA\_ld\_,
00754          ob\_, &ob\_ld\_,
00755          work, &lwork, &info);
00756 \textcolor{preprocessor}{  #endif}
00757 \textcolor{preprocessor}{}
00758   \textcolor{keywordflow}{if} (info == 0) \{
00759     lwork = (int) work[0];
00760   \} \textcolor{keywordflow}{else} \{
00761     std::cerr << \textcolor{stringliteral}{"Could not get value for lwork on line "} << \_\_LINE\_\_ - 2 <<
00762       std::endl;
00763     std::cerr << \textcolor{stringliteral}{"Exiting..."} << std::endl;
00764     \textcolor{keywordflow}{return} info;
00765   \}
00766 
00767 \textcolor{preprocessor}{  #if MTK\_DEBUG\_LEVEL > 0}
00768 \textcolor{preprocessor}{}  std::cout << \textcolor{stringliteral}{"lwork = "} << std::endl << std::setw(12)<< lwork <<
00769     std::endl << std::endl;
00770 \textcolor{preprocessor}{  #endif}
00771 \textcolor{preprocessor}{}
00772   \textcolor{comment}{// We then use lwork's new value to create the work array:}
00773   \textcolor{keyword}{delete}[] work;
00774   work = \textcolor{keyword}{nullptr};
00775 
00776   \textcolor{keywordflow}{try} \{
00777     work = \textcolor{keyword}{new} \hyperlink{group__c01-roots_gac080bbbf5cbb5502c9f00405f894857d}{mtk::Real}[lwork];
00778   \} \textcolor{keywordflow}{catch} (std::bad\_alloc &memory\_allocation\_exception) \{
00779     std::cerr << \textcolor{stringliteral}{"Memory allocation exception on line "} << \_\_LINE\_\_ - 3 << std::endl;
00780     std::cerr << memory\_allocation\_exception.what() << std::endl;
00781   \}
00782   memset(work, 0.0, \textcolor{keyword}{sizeof}(work[0])*lwork);
00783 
00784   \textcolor{comment}{// We now invoke the solver again:}
00785 \textcolor{preprocessor}{  #ifdef MTK\_PRECISION\_DOUBLE}
00786 \textcolor{preprocessor}{}  dgels\_(&trans\_, &AA\_num\_rows\_, &AA\_num\_cols\_, &nrhs\_, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &AA\_ld\_,
00787          ob\_, &ob\_ld\_,
00788          work, &lwork, &info);
00789 \textcolor{preprocessor}{  #else}
00790 \textcolor{preprocessor}{}  \hyperlink{namespacemtk_ada6df1b733204aa7ff0b1ec7556288f9}{sgels\_}(&trans\_, &AA\_num\_rows\_, &AA\_num\_cols\_, &nrhs\_, aa.\hyperlink{classmtk_1_1DenseMatrix_a16b3ff56feb2658b9fc7147d1de4d8e7}{data}(), &AA\_ld\_,
00791          ob\_, &ob\_ld\_,
00792          work, &lwork, &info);
00793 \textcolor{preprocessor}{  #endif}
00794 \textcolor{preprocessor}{}
00795   \textcolor{keyword}{delete} [] work;
00796   work = \textcolor{keyword}{nullptr};
00797 
00798   \textcolor{keywordflow}{return} info;
00799 \}
\end{DoxyCode}
